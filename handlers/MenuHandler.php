<?php

class MenuHandler {
    private $bot;
    private $chatId;
    private $db;
    private $user_id;

    private $contactHandler;
    private $fileHandler;

    private $rules = 'Ð”Ð¾Ð±Ñ€Ð¾Ð³Ð¾ Ð´Ð½Ñ, Ð½Ð°Ð³Ð°Ð´ÑƒÑ”Ð¼Ð¾ ,
Ñ‰Ð¾ Ñ†Ñ Ð³Ñ€ÑƒÐ¿Ð° - Ð´Ð¾Ð±Ñ€Ð¾Ð²Ñ–Ð»ÑŒÐ½Ð¾ ÑÑ‚Ð²Ð¾Ñ€ÐµÐ½Ð°  Ð´Ð»Ñ Ð´Ð¾Ð¿Ð¾Ð¼Ð¾Ð³Ð¸ Ñƒ Ð²Ð¸Ñ€Ñ–ÑˆÐµÐ½Ð½Ñ– Ð¿Ð¸Ñ‚Ð°Ð½ÑŒ Ñ‚Ð° Ð¾Ð±Ð¼Ñ–Ð½Ð¾Ð¼ Ð´Ð¾ÑÐ²Ñ–Ð´Ð¾Ð¼ Ñ‚Ð° Ñ–Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ñ–Ñ”ÑŽ.
ÐÐ´Ð¼Ñ–Ð½Ñ–ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ð¸ Ð³Ñ€ÑƒÐ¿Ð¸ Ð½Ð° Ð²Ð¾Ð»Ð¾Ð½Ñ‚ÐµÑ€ÑÑŒÐºÐ¸Ñ… Ð·Ð°ÑÐ°Ð´Ð°Ñ… Ð´Ð¾Ð¿Ð¾Ð¼Ð°Ð³Ð°ÑŽÑ‚ÑŒ ÑƒÑ‡Ð°ÑÐ½Ð¸ÐºÐ°Ð¼.

       ðŸ“ÐŸÐ ÐÐ’Ð˜Ð›Ð Ð“Ð Ð£ÐŸÐ˜ðŸ“

â˜‘ï¸ÐÐµÐºÐ¾Ñ€ÐµÐºÑ‚Ð½Ðµ Ð·Ð²ÐµÑ€Ð½ÐµÐ½Ð½Ñ Ð´Ð¾ Ð±ÑƒÐ´ÑŒ-ÐºÐ¾Ð³Ð¾ Ð· ÑƒÑ‡Ð°ÑÐ½Ð¸ÐºÑ–Ð² Ð³Ñ€ÑƒÐ¿Ð¸ - 1 Ð¿Ð¾Ð¿ÐµÑ€ÐµÐ´Ð¶ÐµÐ½Ð½Ñ , Ð´Ð°Ð»Ñ– Ð²Ð¸Ð´Ð°Ð»ÐµÐ½Ð½Ñ.
â˜‘ï¸ÐžÐ±Ñ€Ð°Ð·Ð°  Ð±ÑƒÐ´ÑŒ-ÐºÐ¾Ð³Ð¾ Ð· ÑƒÑ‡Ð°ÑÐ½Ð¸ÐºÑ–Ð² Ñ‡Ð°Ñ‚Ñƒ -Ð²Ð¸Ð´Ð°Ð»ÐµÐ½Ð½Ñ 
â˜‘ï¸Ð Ð¾Ð·Ð²ÐµÐ´ÐµÐ½Ð½Ñ  ÑÑ€Ð°Ñ‡Ñƒ , Ð·Ñ€Ð°Ð´Ð¸ Ñ– Ñ‚.Ð´ -1 Ð¿Ð¾Ð¿ÐµÑ€ÐµÐ´Ð¶ÐµÐ½Ð½Ñ, Ð´Ð°Ð»Ñ– Ð²Ð¸Ð´Ð°Ð»ÐµÐ½Ð½Ñ.
â˜‘ï¸Ð—Ð°Ð±Ð¾Ñ€Ð¾Ð½ÑÑ”Ñ‚ÑŒÑÑ Ð¿Ð¾ÑÑ‚Ð¸Ñ‚Ð¸ Ð·Ð±Ð¾Ñ€Ð¸ Ð±ÐµÐ· Ð´Ð¾Ð·Ð²Ð¾Ð»Ñƒ Ð°Ð´Ð¼Ñ–Ð½Ñ–Ð² Ð³Ñ€ÑƒÐ¿Ð¸.


â„¹ï¸ ÐÐ° Ñ€Ð°Ñ…ÑƒÐ½Ð¾Ðº Ñ–Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ñ–Ñ— Ð¿Ñ€Ð¾ Ð½Ð°ÑˆÑƒ Ð±Ñ€Ð¸Ð³Ð°Ð´Ñƒ Ð· Ñ–Ð½ÑˆÐ¸Ñ… Ñ€ÐµÑÑƒÑ€ÑÑ–Ð²:
ðŸ“Œ Ð¯ÐºÑ‰Ð¾ Ñ–Ð½Ñ„Ð° Ð¿Ñ€Ð¾ÑÑÐ½ÑŽÑ” ÑÐ¸Ñ‚ÑƒÐ°Ñ†Ñ–ÑŽ Ñ‡Ð¸ ÑÑ‚Ð°Ð½ Ð½Ð° Ð´ÐµÑÐºÐ¸Ñ… Ñ‚ÐµÑ€Ð¸Ñ‚Ð¾Ñ€Ñ–ÑÑ… ÑÐºÑ– Ð¿Ð¾Ð²ÑÐ·Ð°Ð½Ñ– Ñ–Ð· Ð·Ð½Ð¸ÐºÐ½ÐµÐ½Ð½ÑÐ¼/ Ð¿Ð¾Ð»Ð¾Ð½Ð¾Ð¼ Ñ‡Ð¸ Ð²Ð¾Ñ”Ð½Ð½Ð¸Ð¼Ð¸ Ð´Ñ–ÑÐ¼Ð¸ Ð°Ð±Ð¾ Ð½Ð°Ñ…Ð¾Ð´Ð¶ÐµÐ½Ð½Ñ Ð½Ð°ÑˆÐ¾Ñ— Ð±Ñ€Ð¸Ð³Ð°Ð´Ð¸ Ð½Ð° Ñ‚Ð°ÐºÐ¸Ñ… Ñ‚ÐµÑ€Ð¸Ñ‚Ð¾Ñ€Ñ–ÑÑ…- Ð¼Ð¾Ð¶Ð½Ð° ÑÐºÐ¸Ð´ÑƒÐ²Ð°Ñ‚Ð¸ Ñ‚Ð°ÐºÑƒ Ñ–Ð½Ñ„Ñƒ Ð² Ð³Ñ€ÑƒÐ¿Ñƒ
ðŸ“Œ Ð”Ð¾ Ð±ÑƒÐ´ÑŒ ÑÐºÐ¾Ñ— Ñ–Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ñ–Ñ— Ð¿Ñ€Ð¾ÑˆÑƒ Ð²Ñ–Ð´Ð½Ð¾ÑÐ¸Ñ‚ÑŒ Ð· Ñ€Ð¾Ð·ÑƒÐ¼Ð¾Ð¼ Ñ– Ñ€Ð¾Ð·ÑƒÐ¼Ñ–Ñ‚Ð¸ Ñ‰Ð¾ Ð¼Ð¾Ð¶Ð»Ð¸Ð²Ð¾ Ñ–Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ñ–Ñ Ð¿Ð¾Ð´Ð°Ð½Ð° Ð´Ð¶ÐµÑ€ÐµÐ»Ð¾Ð¼ Ð½Ðµ Ð· Ð´Ð¾Ð±Ñ€Ð¸Ð¼Ð¸ Ð½Ð°Ð¼Ñ–Ñ€Ð°Ð¼Ð¸ Ð°Ð±Ð¾ Ð½Ðµ ÑÐ²Ð»ÑÑ”Ñ‚ÑŒÑÑ Ð¿Ñ€Ð°Ð²Ð´Ð¾ÑŽ ( ÑÑ‚Ð¾ÑÑƒÑ”Ñ‚ÑŒÑÑ ÑÐº ÑƒÐºÑ€ ÑÑ‚Ð¾Ñ€Ð¾Ð½Ð¸ Ñ‚Ð°Ðº Ñ– Ñ€Ð¾Ñ)
ðŸ“Œ Ð’Ñ–Ð´ÐµÐ¾/ Ñ„Ð¾Ñ‚Ð¾ ÑÐºÑ– Ð¼Ñ–ÑÑ‚ÑÑ‚ÑŒ Ð´ÑƒÐ¶Ðµ ÑÐ¿ÐµÑ†Ð¸Ñ„Ñ–Ñ‡Ð½Ñƒ Ñ–Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ñ–ÑŽ ( ÑÐ¼ÐµÑ€Ñ‚ÑŒ, Ð·Ð½ÑƒÑ‰Ð°Ð½Ð½Ñ, ÐºÐ°Ñ‚ÑƒÐ²Ð°Ð½Ð½Ñ Ñ‡Ð¸ Ñ‰Ð¾ÑÑŒ Ð¿Ð¾Ð´Ñ–Ð±Ð½Ðµ) ÑÐºÑƒ Ð½Ðµ Ð²ÑÑ– Ð¼Ð¾Ð¶ÑƒÑ‚ÑŒ Ð²Ð¸Ñ‚Ñ€Ð¸Ð¼Ð°Ñ‚Ð¸, Ð°Ð±Ð¾ Ñ†Ðµ Ð¼Ð¾Ð¶Ðµ Ð¿Ð¾Ð²Ð¿Ð»Ð¸Ð²Ð°Ñ‚Ð¸ Ð½Ð° Ð¿ÑÐ¸Ñ…Ñ–Ñ‡Ð½Ð¸Ð¹ ÑÑ‚Ð°Ð½
Ð›Ð®Ð”Ð˜ÐÐ˜ - â€¼ï¸ Ð—ÐÐ‘ÐžÐ ÐžÐÐ ÐÐ
Ð ÐžÐ—ÐŸÐžÐ’Ð¡Ð®Ð”Ð–Ð•ÐÐÐ¯ Ð’ Ð¦Ð†Ð™ Ð“Ð Ð£ÐŸÐ† â€¼ï¸
ðŸ“Œ Ð’Ñ–Ð´ÐµÐ¾/Ñ„Ð¾Ñ‚Ð¾ Ð· Ð½Ð°ÑˆÐ¸Ð¼Ð¸ Ð²Ñ–Ð¹ÑÑŒÐºÐ¾Ð²Ð¸Ð¼Ð¸ Ð·
151 Ð¾Ð¼Ð±Ñ€ ÑÐºÐ¸Ñ… Ð²Ð¸ÑÐ²Ð¸Ð»Ð¸ Ð² Ð¿Ð¾Ð»Ð¾Ð½Ñ– - Ð·Ð²Ñ–ÑÐ½Ð¾
Ð¼Ð¾Ð¶Ð½Ð° Ð¿ÐµÑ€ÐµÑÐ¸Ð»Ð°Ñ‚Ð¸ Ð² Ñ†ÑŽ Ð³Ñ€ÑƒÐ¿Ñƒ ( Ð¿Ñ€Ð¾ÑˆÑƒ Ð¿ÐµÑ€ÐµÐºÐ¾Ð½Ð°Ñ‚Ð¸ÑÑŒ Ñ‰Ð¾ Ñ†Ðµ Ð½Ðµ ÑÑ‚Ð°Ñ€Ð°
Ñ–Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ñ–Ñ Ð°Ð±Ð¾ Ð¼Ð¾Ð¶Ð»Ð¸Ð²Ð¾ Ð²Ð¾Ð½Ð¸ Ð²Ð¶Ðµ Ñ” Ð² Ð½Ð°ÑˆÑ–Ð¹ Ð³Ñ€ÑƒÐ¿Ñ–)

ÐŸÑ€Ð¾ÑÐ¸Ð¼Ð¾ Ð²Ñ–Ð´Ð½Ð¾ÑÐ¸Ñ‚Ð¸ÑÑŒ Ð´Ð¾ Ð²ÑÑ–Ñ… ÑƒÑ‡Ð°ÑÐ½Ð¸ÐºÑ–Ð² Ð· Ð¿Ð¾Ð²Ð°Ð³Ð¾ÑŽ. 
Ð”ÑÐºÑƒÑ”Ð¼Ð¾ Ð·Ð° Ñ€Ð¾Ð·ÑƒÐ¼Ñ–Ð½Ð½Ñ!ðŸ’™ðŸ’›';

    public function __construct($bot, $chatId, $db, $user_id, $fileHandler) {
        $this->bot = $bot;
        $this->chatId = $chatId;
        $this->db = $db;
        $this->user_id = $user_id;
        $this->contactHandler = new ContactHandler($this->bot, $this->chatId, $this->db);
        $this->fileHandler = $fileHandler;
    }

    public function handleMessage($text) {
        switch ($text) {
            case '/Ð´Ð¾Ð¿Ð¾Ð¼Ð¾Ð³Ð°':
                $this->showMainMenu();
                break;
        }
    }

    private function showMainMenu() {
        $keyboard = [
            'inline_keyboard' => [
                [['text' => 'ðŸ“ž ÐšÐ¾Ð½Ñ‚Ð°ÐºÑ‚Ð¸', 'callback_data' => 'contacts']],
                [['text' => 'ðŸ“œ ÐŸÑ€Ð°Ð²Ð¸Ð»Ð°', 'callback_data' => 'rules']],
                [['text' => 'ðŸ“ Ð—Ñ€Ð°Ð·ÐºÐ¸ Ð·Ð°ÑÐ² Ñ‚Ð° Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ñ–Ð²', 'callback_data' => 'files']],
            ]
        ];

        $this->bot->sendMessage($this->chatId, "ðŸ“Œ *Ð“Ð¾Ð»Ð¾Ð²Ð½Ðµ Ð¼ÐµÐ½ÑŽ:*\nÐžÐ±ÐµÑ€Ñ–Ñ‚ÑŒ Ð¿ÑƒÐ½ÐºÑ‚:", $keyboard);

    }

    public function handleCallback($callbackData) {
        switch ($callbackData) {
            case 'contacts':
                $this->contactHandler->showContactsMenu();
                break;
            case 'rules':
                $this->bot->sendMessage($this->chatId, $this->rules, ['parse_mode' => 'Markdown']);
                break;
            case 'files':
                $this->fileHandler->showFiles();
                break;
            case 'go_back':
                $this->showMainMenu();
                break;
        }
    }

}
